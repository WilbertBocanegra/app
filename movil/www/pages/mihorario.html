<template>
  <div class="page" data-name="mihorario">
    <div class="navbar no-shadow  tahold">
      <div class="navbar-bg"></div>
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link panel-open" data-panel=".panel-left"><i class="icon f7-icons">bars</i></a>
        </div>
        <div class="title">Mi horario</div>
      </div>
    </div>

    <div class="toolbar tabbar tabbar-labels toolbar-top bg-color-white">
      <div class="toolbar-inner">
        <a href="#lunes" class="tab-link lunes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Lunes</span>
        </a>
        <a href="#martes" class="tab-link martes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Martes</span>
        </a>
        <a href="#miercoles" class="tab-link miercoles click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Miercoles</span>
        </a>
        <a href="#jueves" class="tab-link jueves click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Jueves</span>
        </a>
        <a href="#viernes" class="tab-link viernes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Viernes</span>
        </a>
      </div>
    </div>

    <div class="tabs-swipeable-wrap">
      <div class="tabs">
        <div id="lunes" class="page-content sinhorario tab tab-lunes">


          <div class="list" style="margin-bottom:0px; margin-top:0px;">
            <ul>
              <li class="item-divider"></li>
              {{#each lunes}}
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">clock_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Hora</div>
                        | {{hora}}
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">rectangle_fill_on_rectangle_angled_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Materia</div>
                        | {{hrtext}}
                      </div>
                    </div>
                  </div>
                </li>
                <li class="item-divider"></li>
              {{/each}}
            </ul>
          </div>
        </div>
        <div id="martes" class="page-content sinhorario tab tab-martes">
          <div class="list" style="margin-bottom:0px; margin-top:0px;">
            <ul>
              <li class="item-divider"></li>
              {{#each martes}}
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">clock_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Hora</div>
                        | {{hora}}
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">rectangle_fill_on_rectangle_angled_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Materia</div>
                        | {{hrtext}}
                      </div>
                    </div>
                  </div>
                </li>
                <li class="item-divider"></li>
              {{/each}}
            </ul>
          </div>
        </div>
        <div id="miercoles" class="page-content sinhorario tab tab-miercoles">
          <div class="list" style="margin-bottom:0px; margin-top:0px;">
            <ul>
              <li class="item-divider"></li>
              {{#each miercoles}}
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">clock_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Hora</div>
                        | {{hora}}
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">rectangle_fill_on_rectangle_angled_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Materia</div>
                        | {{hrtext}}
                      </div>
                    </div>
                  </div>
                </li>
                <li class="item-divider"></li>
              {{/each}}
            </ul>
          </div>
        </div>
        <div id="jueves" class="page-content sinhorario tab tab-jueves">
          <div class="list" style="margin-bottom:0px; margin-top:0px;">
            <ul>
              <li class="item-divider"></li>
              {{#each jueves}}
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">clock_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Hora</div>
                        | {{hora}}
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">rectangle_fill_on_rectangle_angled_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Materia</div>
                        | {{hrtext}}
                      </div>
                    </div>
                  </div>
                </li>
                <li class="item-divider"></li>
              {{/each}}
            </ul>
          </div>
        </div>
        <div id="viernes" class="page-content sinhorario tab tab-viernes">
          <div class="list" style="margin-bottom:0px; margin-top:0px;">
            <ul>
              <li class="item-divider"></li>
              {{#each viernes}}
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">clock_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Hora</div>
                        | {{hora}}
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-media"><i class="f7-icons">rectangle_fill_on_rectangle_angled_fill</i></div>
                    <div class="item-inner">
                      <div class="item-title" style="white-space:normal; overflow: visible;">
                        <div class="item-header">Materia</div>
                        | {{hrtext}}
                      </div>
                    </div>
                  </div>
                </li>
                <li class="item-divider"></li>
              {{/each}}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>

  showScheduler = (data, handler)=>{
    var days = {
      lunes:[],
      martes:[],
      miercoles:[],
      jueves:[],
      viernes:[]
    };
    
        var mihorario = JSON.parse(data).data.map((a) => {
          a.hora = a.hora.replace(/(\d\d)(\d\d)/, '$1:$2');
          return a;
        });
        days.lunes = mihorario.filter((a, i) => {
          if (a.dia == 1) return a
        })
        days.martes = mihorario.filter((a, i) => {
          if (a.dia == 2) return a
        })
        days.miercoles = mihorario.filter((a, i) => {
          if (a.dia == 3) return a
        })
        days.jueves = mihorario.filter((a, i) => {
          if (a.dia == 4) return a
        })
        days.viernes = mihorario.filter((a, i) => {
          if (a.dia == 5) return a
        });
        handler(days);
  } 


  return {
    data: function() {
      return {
        perfil: [],
        lunes: [],
        martes: [],
        miercoles: [],
        jueves: [],
        viernes: [],
        loading: true,
      }
    },
    methods: {

    },
    on: {
      pageMounted: function() {
        var fecha = new Date();
        var dias = new Array('domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado')
        var hora = fecha.getHours();

        if (dias[fecha.getDay()] == "lunes") {
          $$('.lunes').addClass('tab-link-active');
          $$('.tab-lunes').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "martes") {
          $$('.martes').addClass('tab-link-active');
          $$('.tab-martes').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "miercoles") {
          $$('.miercoles').addClass('tab-link-active');
          $$('.tab-miercoles').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "jueves") {
          $$('.jueves').addClass('tab-link-active');
          $$('.tab-jueves').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "viernes") {
          $$('.viernes').addClass('tab-link-active');
          $$('.tab-viernes').addClass('tab-active');
        }
        var self = this;
        var app = self.$app;

      },

      pageInit: function() {
        var self = this;
        var app = self.$app;
        var data = localStorage.getItem("horario");
        if(!data){
          var datos = JSON.parse(localStorage.getItem('id'));
          app.request({
            url: 'http://webcore.uttab.edu.mx/webcore/apps/bin/getdata.jsp',
            headers: {
              Authorization: datos.Authorization
            },
            success: function(data) {
              showScheduler(data,(days)=>{
                self.$setState({
                lunes: days.lunes,
                martes: days.martes,
                miercoles: days.miercoles,
                jueves: days.jueves,
                viernes: days.viernes
              });
              });
            }
          });
        }else{
          showScheduler(data, (days)=>{
            self.$setState({
              lunes: days.lunes,
              martes: days.martes,
              miercoles: days.miercoles,
              jueves: days.jueves,
              viernes: days.viernes
            });
          });
        }
      },

    },
  };
</script>
