<template>
  <div class="page" data-name="mihorario">
    <div class="navbar no-shadow">
      <div class="navbar-inner sliding">
        <div class="title" style="-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;">Mi horario</div>
      </div>
    </div>

    <div class="toolbar tabbar tabbar-labels toolbar-top bg-color-white">
      <div class="toolbar-inner">
        <a href="#lunes" class="tab-link lunes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Lunes</span>
        </a>
        <a href="#martes" class="tab-link martes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Martes</span>
        </a>
        <a href="#miercoles" class="tab-link miercoles click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Miercoles</span>
        </a>
        <a href="#jueves" class="tab-link jueves click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Jueves</span>
        </a>
        <a href="#viernes" class="tab-link viernes click">
          <i class="icon f7-icons">calendar_today</i>
          <span class="tabbar-label">Viernes</span>
        </a>
      </div>
    </div>

    <div class="tabs-swipeable-wrap">
      <div class="tabs">
        <div id="lunes" class="page-content sinhorario tab tab-lunes">

          {{#if loading}}
            <div class="block-title"></div>
            <div class="block block-strong align-items-stretch text-align-center no-hairlines">
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader confi-preloader color-multi"></div>
                </div>
              </div>
            </div>
          {{else}}
            <div class="list" style="margin-bottom:0px; margin-top:0px;">
              <ul>
                <li class="item-divider"></li>
                {{#each lunes}}

                  {{#each materias}}
                    <!--  <div class="card">
              <div class="card-header">{{inicia}}:00 - {{termina}}:00</div>
              <div class="card-content card-content-padding">
                <div class="display-flex justify-content-space-between align-items-flex-start margin-bottom">
                  <div class="flex-shrink-0"></div>
                  <div class="align-self-center">{{materia}}</div>
                  <div class="align-self-flex-end"></div>
                </div>
                {{maestro}}
              </div>
              <div class="card-footer display-flex justify-content-space-between align-items-flex-start ">
                <div class="chip color-orange flex-shrink-0 chip-label">Edificio: {{edificio}}</div>
                <div class="chip color-blue align-self-flex-end chip-label ">Salon: {{salon}}</div>
              </div>
            </div>-->

                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">time</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Hora</div>
                            | {{inicia}}:00 - {{termina}}:00
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">collection</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Materia</div>
                            | {{materia}}
                          </div>
                        </div>
                      </div>
                    </li>
                    {{#if maestro}}
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">person</i></div>
                          <div class="item-inner">
                            <div class="item-title" style="white-space:normal; overflow: visible;">
                              <div class="item-header">Maestro</div>
                              | {{maestro}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">business</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Edificio</div>
                              | {{edificio}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">data_fill</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Salón</div>
                              | {{salon}}
                            </div>
                          </div>
                        </div>
                      </li>
                    {{else}}
                      <div class="" style="display:none">

                      </div>
                    {{/if}}

                    <li class="item-divider"></li>

                  {{/each}}
                {{/each}}
              </ul>
            </div>
          {{/if}}
        </div>
        <div id="martes" class="page-content sinhorario tab tab-martes">
          {{#if loading}}
            <div class="block-title"></div>
            <div class="block block-strong align-items-stretch text-align-center no-hairlines">
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader confi-preloader color-multi"></div>
                </div>
              </div>
            </div>

          {{else}}
            <div class="list" style="margin-bottom:0px; margin-top:0px;">
              <ul>
                <li class="item-divider"></li>
                {{#each martes}}

                  {{#each materias}}
                    <!--  <div class="card">
              <div class="card-header">{{inicia}}:00 - {{termina}}:00</div>
              <div class="card-content card-content-padding">
                <div class="display-flex justify-content-space-between align-items-flex-start margin-bottom">
                  <div class="flex-shrink-0"></div>
                  <div class="align-self-center">{{materia}}</div>
                  <div class="align-self-flex-end"></div>
                </div>
                {{maestro}}
              </div>
              <div class="card-footer display-flex justify-content-space-between align-items-flex-start ">
                <div class="chip color-orange flex-shrink-0 chip-label">Edificio: {{edificio}}</div>
                <div class="chip color-blue align-self-flex-end chip-label ">Salon: {{salon}}</div>
              </div>
            </div>-->

                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">time</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Hora</div>
                            | {{inicia}}:00 - {{termina}}:00
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">collection</i></div>
                        <div class="item-inner">
                          <div class="item-title" style="white-space:normal; overflow: visible;">
                            <div class="item-header">Materia</div>
                            | {{materia}}
                          </div>
                        </div>
                      </div>
                    </li>
                    {{#if maestro}}
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">person</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Maestro</div>
                              | {{maestro}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">business</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Edificio</div>
                              | {{edificio}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">data_fill</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Salón</div>
                              | {{salon}}
                            </div>
                          </div>
                        </div>
                      </li>
                    {{else}}
                      <div class="" style="display:none">

                      </div>
                    {{/if}}

                    <li class="item-divider"></li>

                  {{/each}}
                {{/each}}
              </ul>
            </div>

          {{/if}}
        </div>
        <div id="miercoles" class="page-content sinhorario tab tab-miercoles">
          {{#if loading}}
            <div class="block-title"></div>
            <div class="block block-strong align-items-stretch text-align-center no-hairlines">
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader confi-preloader color-multi"></div>
                </div>
              </div>
            </div>

          {{else}}
            <div class="list" style="margin-bottom:0px; margin-top:0px;">
              <ul>
                <li class="item-divider"></li>
                {{#each miercoles}}

                  {{#each materias}}
                    <!--  <div class="card">
              <div class="card-header">{{inicia}}:00 - {{termina}}:00</div>
              <div class="card-content card-content-padding">
                <div class="display-flex justify-content-space-between align-items-flex-start margin-bottom">
                  <div class="flex-shrink-0"></div>
                  <div class="align-self-center">{{materia}}</div>
                  <div class="align-self-flex-end"></div>
                </div>
                {{maestro}}
              </div>
              <div class="card-footer display-flex justify-content-space-between align-items-flex-start ">
                <div class="chip color-orange flex-shrink-0 chip-label">Edificio: {{edificio}}</div>
                <div class="chip color-blue align-self-flex-end chip-label ">Salon: {{salon}}</div>
              </div>
            </div>-->

                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">time</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Hora</div>
                            | {{inicia}}:00 - {{termina}}:00
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">collection</i></div>
                        <div class="item-inner">
                          <div class="item-title" style="white-space:normal; overflow: visible;">
                            <div class="item-header">Materia</div>
                            | {{materia}}
                          </div>
                        </div>
                      </div>
                    </li>
                    {{#if maestro}}
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">person</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Maestro</div>
                              | {{maestro}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">business</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Edificio</div>
                              | {{edificio}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">data_fill</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Salón</div>
                              | {{salon}}
                            </div>
                          </div>
                        </div>
                      </li>
                    {{else}}
                      <div class="" style="display:none">

                      </div>
                    {{/if}}

                    <li class="item-divider"></li>

                  {{/each}}
                {{/each}}
              </ul>
            </div>

          {{/if}}
        </div>
        <div id="jueves" class="page-content sinhorario tab tab-jueves">
          {{#if loading}}
            <div class="block-title"></div>
            <div class="block block-strong align-items-stretch text-align-center no-hairlines">
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader confi-preloader color-multi"></div>
                </div>
              </div>
            </div>

          {{else}}
            <div class="list" style="margin-bottom:0px; margin-top:0px;">
              <ul>
                <li class="item-divider"></li>
                {{#each jueves}}

                  {{#each materias}}
                    <!--  <div class="card">
              <div class="card-header">{{inicia}}:00 - {{termina}}:00</div>
              <div class="card-content card-content-padding">
                <div class="display-flex justify-content-space-between align-items-flex-start margin-bottom">
                  <div class="flex-shrink-0"></div>
                  <div class="align-self-center">{{materia}}</div>
                  <div class="align-self-flex-end"></div>
                </div>
                {{maestro}}
              </div>
              <div class="card-footer display-flex justify-content-space-between align-items-flex-start ">
                <div class="chip color-orange flex-shrink-0 chip-label">Edificio: {{edificio}}</div>
                <div class="chip color-blue align-self-flex-end chip-label ">Salon: {{salon}}</div>
              </div>
            </div>-->

                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">time</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Hora</div>
                            | {{inicia}}:00 - {{termina}}:00
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">collection</i></div>
                        <div class="item-inner">
                          <div class="item-title" style="white-space:normal; overflow: visible;">
                            <div class="item-header">Materia</div>
                            | {{materia}}
                          </div>
                        </div>
                      </div>
                    </li>
                    {{#if maestro}}
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">person</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Maestro</div>
                              | {{maestro}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">business</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Edificio</div>
                              | {{edificio}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">data_fill</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Salón</div>
                              | {{salon}}
                            </div>
                          </div>
                        </div>
                      </li>
                    {{else}}
                      <div class="" style="display:none">

                      </div>
                    {{/if}}

                    <li class="item-divider"></li>

                  {{/each}}
                {{/each}}
              </ul>
            </div>
          {{/if}}
        </div>
        <div id="viernes" class="page-content sinhorario tab tab-viernes">
          {{#if loading}}
            <div class="block-title"></div>
            <div class="block block-strong align-items-stretch text-align-center no-hairlines">
              <div class="row text-align-center">
                <div class="col-100">
                  <div class="preloader confi-preloader color-multi"></div>
                </div>
              </div>
            </div>

          {{else}}
            <div class="list" style="margin-bottom:0px; margin-top:0px;">
              <ul>
                <li class="item-divider"></li>
                {{#each viernes}}

                  {{#each materias}}
                    <!--  <div class="card">
              <div class="card-header">{{inicia}}:00 - {{termina}}:00</div>
              <div class="card-content card-content-padding">
                <div class="display-flex justify-content-space-between align-items-flex-start margin-bottom">
                  <div class="flex-shrink-0"></div>
                  <div class="align-self-center">{{materia}}</div>
                  <div class="align-self-flex-end"></div>
                </div>
                {{maestro}}
              </div>
              <div class="card-footer display-flex justify-content-space-between align-items-flex-start ">
                <div class="chip color-orange flex-shrink-0 chip-label">Edificio: {{edificio}}</div>
                <div class="chip color-blue align-self-flex-end chip-label ">Salon: {{salon}}</div>
              </div>
            </div>-->

                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">time</i></div>
                        <div class="item-inner">
                          <div class="item-title">
                            <div class="item-header">Hora</div>
                            | {{inicia}}:00 - {{termina}}:00
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="item-content">
                        <div class="item-media"><i class="f7-icons">collection</i></div>
                        <div class="item-inner">
                          <div class="item-title" style="white-space:normal; overflow: visible;">
                            <div class="item-header">Materia</div>
                            | {{materia}}
                          </div>
                        </div>
                      </div>
                    </li>
                    {{#if maestro}}
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">person</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Maestro</div>
                              | {{maestro}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">business</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Edificio</div>
                              | {{edificio}}
                            </div>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="item-content">
                          <div class="item-media"><i class="f7-icons">data_fill</i></div>
                          <div class="item-inner">
                            <div class="item-title">
                              <div class="item-header">Salón</div>
                              | {{salon}}
                            </div>
                          </div>
                        </div>
                      </li>
                    {{else}}
                      <div class="" style="display:none">

                      </div>
                    {{/if}}

                    <li class="item-divider"></li>

                  {{/each}}
                {{/each}}
              </ul>
            </div>

          {{/if}}
        </div>
      </div>
    </div>
    <div class="page-content hide-navbar-on-scroll">

    </div>
  </div>
</template>

<script>
  return {
    data: function() {
      return {
        perfil: [],
        lunes: [],
        martes: [],
        miercoles: [],
        jueves: [],
        viernes: [],
        loading: true,
      }
    },
    methods: {

    },
    on: {
      pageMounted: function() {

        /*
                var docData = {

                  materias: [{
                      inicia: 7,
                      termina: 8,
                      maestro: "Octavio Elias Sánchez Aquino",
                      materia: "Base De Datos",
                      salon: "11",
                      edificio: "1"
                    }, {
                      inicia: 8,
                      termina: 9,
                      maestro: "Octavio Elias Sánchez Aquino",
                      materia: "Base De Datos",
                      salon: "11",
                      edificio: "1"
                    },
                    {
                      inicia: 9,
                      termina: 10,
                      maestro: "Octavio Elias Sánchez Aquino",
                      materia: "Graficación Multimedia",
                      salon: "11",
                      edificio: "1"
                    },
                    {
                      inicia: 10,
                      termina: 11,
                      maestro: "José Ney Garrido Vázquez",
                      materia: "Análisis De Sistemas",
                      salon: "7",
                      edificio: "2"
                    },
                    {
                      inicia: 11,
                      termina: 12,
                      maestro: "José Ney Garrido Vázquez",
                      materia: "Análisis De Sistemas",
                      salon: "7",
                      edificio: "2"
                    },
                    {
                      inicia: 12,
                      termina: 13,
                      maestro: "José Ney Garrido Vázquez",
                      materia: "Compiladores E Interprete",
                      salon: "11",
                      edificio: "2"
                    },
                    {
                      inicia: 13,
                      termina: 14,
                      maestro: "José Ney Garrido Vázquez",
                      materia: "Compiladores E Interprete",
                      salon: "11",
                      edificio: "2"
                    },
                    {
                      inicia: 14,
                      termina: 15,
                      maestro: "Jose Luis Hernández Lazo",
                      materia: "Ética Profesional",
                      salon: "2",
                      edificio: "1"
                    },
                  ],

                };
                db.collection("horarios/Software/grupos/S1-6/dias").doc("viernes").set(docData).then(function() {
                  console.log("Document successfully written!");
                });
        */
        var fecha = new Date();
        var dias = new Array('domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado')
        var hora = fecha.getHours();

        if (dias[fecha.getDay()] == "lunes") {
          $$('.lunes').addClass('tab-link-active');
          $$('.tab-lunes').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "martes") {
          console.log("hoy es martes");
          $$('.martes').addClass('tab-link-active');
          $$('.tab-martes').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "miercoles") {
          console.log("hoy es miercoles");
          $$('.miercoles').addClass('tab-link-active');
          $$('.tab-miercoles').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "jueves") {
          console.log("hoy es jueves");
          $$('.jueves').addClass('tab-link-active');
          $$('.tab-jueves').addClass('tab-active');
        } else if (dias[fecha.getDay()] == "viernes") {
          console.log("hoy es viernes");
          $$('.viernes').addClass('tab-link-active');
          $$('.tab-viernes').addClass('tab-active');
        }
        var self = this;
        var app = self.$app;
        let _perfil = [];
        let _lunes = [];
        let _martes = [];
        let _miercoles = [];
        let _jueves = [];
        let _viernes = [];
        var name, email, photoUrl, uid, emailVerified;
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            name = user.displayName;
            email = user.email;
            emailVerified = user.emailVerified;
            photoURL = user.photoURL;
            isAnonymous = user.isAnonymous;
            uid = user.uid;
            providerData = user.providerData;


            var consulta_perfil = db.collection("usuarios").doc(email);
            consulta_perfil.get().then(function(doc) {
              if (doc.exists) {

                if (doc.data().grupo == '') {
                  self.$setState({
                    loading: false
                  });
                  $$('.sinhorario').html(
                    '<div class="block text-align-center tahold" style="font-size:24px;font-weight:bold; margin-top:15%;">No ha registrado ningun horario, por favor seleccione el apartado Mi Cuenta y registre su horario</div>');
                } else {
                  _perfil.push({
                    grupo: doc.data().grupo,
                  })
                  self.$setState({
                    perfil: _perfil,
                  });
                  var consulta_lunes = db.collection("horarios/" + doc.data().carrera + "/grupos/" + doc.data().grupo + "/dias").doc("lunes");
                  var consulta_martes = db.collection("horarios/" + doc.data().carrera + "/grupos/" + doc.data().grupo + "/dias").doc("martes");
                  var consulta_miercoles = db.collection("horarios/" + doc.data().carrera + "/grupos/" + doc.data().grupo + "/dias").doc("miercoles");
                  var consulta_jueves = db.collection("horarios/" + doc.data().carrera + "/grupos/" + doc.data().grupo + "/dias").doc("jueves");
                  var consulta_viernes = db.collection("horarios/" + doc.data().carrera + "/grupos/" + doc.data().grupo + "/dias").doc("viernes");

                  consulta_lunes.get().then(function(doc) {
                    if (doc.exists) {
                      _lunes.push({
                        materias: doc.data().materias,
                      })
                      self.$setState({
                        lunes: _lunes,
                      });
                      self.$setState({
                        loading: false
                      });
                    } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                    }
                  }).catch(function(error) {
                    console.log("Error getting document:", error);
                  });

                  consulta_martes.get().then(function(doc) {
                    if (doc.exists) {
                      _martes.push({
                        materias: doc.data().materias,
                      })
                      self.$setState({
                        martes: _martes,
                      });
                      self.$setState({
                        loading: false
                      });
                    } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                    }
                  }).catch(function(error) {
                    console.log("Error getting document:", error);
                  });

                  consulta_miercoles.get().then(function(doc) {
                    if (doc.exists) {
                      _miercoles.push({
                        materias: doc.data().materias,

                      })
                      self.$setState({
                        miercoles: _miercoles,
                      });
                      self.$setState({
                        loading: false
                      });
                    } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                    }
                  }).catch(function(error) {
                    console.log("Error getting document:", error);
                  });



                  consulta_jueves.get().then(function(doc) {
                    if (doc.exists) {
                      _jueves.push({
                        materias: doc.data().materias,

                      })
                      self.$setState({
                        jueves: _jueves,
                      });
                      self.$setState({
                        loading: false
                      });
                    } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                    }
                  }).catch(function(error) {
                    console.log("Error getting document:", error);
                  });

                  consulta_viernes.get().then(function(doc) {
                    if (doc.exists) {
                      _viernes.push({
                        materias: doc.data().materias,

                      })
                      self.$setState({
                        viernes: _viernes,
                      });
                      self.$setState({
                        loading: false
                      });
                    } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                    }
                  }).catch(function(error) {
                    console.log("Error getting document:", error);
                  });

                }




              } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
              }
            }).catch(function(error) {
              console.log("Error getting document:", error);
            });
          } else {
            // User is signed out.
          }
        });


      },
      pageInit: () => {
        var $ptrContent = $$('.ptr-content');
        // Add 'refresh' listener on it
        $ptrContent.on('ptr:refresh', function(e) {
          mainView.router.refreshPage()
        }, 5000);

      },

    },
  };
</script>
